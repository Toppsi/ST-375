% !TeX spellcheck = da_DK
\chapter{Syntese}
\section{Diskussion}
Formålet med projektet er at udvikle et samlet system, som kan give visuel og somatosensorisk biofeedback under rehabilitering af apopleksipatienter med balanceproblemer jævnfør \ref{formaal_anvendelse} på side \pageref{formaal_anvendelse}. Systemet er udviklet på baggrund af raske forsøgspersoner, da balancenfunktionen er individuel jævnfør afsnit \ref{BalanceAfsnit} på side \pageref{BalanceAfsnit}. Det vurderes, at dette danner det bedste grundlag for udvikling og systemet kan herfra videreudvikles og tilpasses de enkelte patienter. 

\subsection{Målemetoder og pilotforsøg}
Systemet og de enkelte blokke er primært designet på baggrund af det udførte pilotforsøg i bilag \ref{Bilag:Pilotforsoeg} på side \pageref{Bilag:Pilotforsoeg}. De målte data under pilotforsøget kan imidlertid være påvirket af forskellige faktorer, herunder lokalets temperatur på dagen for forsøgets udførelse samt støj fra omgivelserne. Dette kan have indflydelse på de beregnede værdier i systemets forskellige blokke.
Ydermere kan pilotforsøgets metode have væsentlig betydning ift. afvigelser i de beregnede værdier. Eksempelvis er spændingen ved de enkelte hældningsgrader udregnet ved at måle spændingen ved $0^{\circ}$ samt $\pm90^{\circ}$ og efterfølgende udregne spændingen for de enkelte grader, hvor feedbacken skal udløses. Desuden er selve rotationsmålingerne udført ved, at en person har roteret accelerometeret med hånden til hhv. højre og venstre. Der er således flere steder i processen, hvor de endelige resultater kan være blevet påvirket. Disse fejlkilder kunne have været begrænset ved anvendelse af mere præcist udstyr til opmåling af vinkler, hvor det desuden kunne være muligt at måle den præcise hældning ved de udvalgte grader, frem for at udregne den.  \\
De målte data kan desuden være påvirket af afvigelser i de anvendte måleapparater, herunder oscilloskop, multimeter og optagelse med ADC. De forskellige apparater kan kun måle et begrænset antal decimaler og værdierne kan således variere ift. teorien. Derudover vil der være afvigelse ift. de anvendte komponenter under implementeringen, da der her arbejdes med reelle komponenter. Visse komponenter, herunder operationsforstærkere og komparatorer, har i forvejen oplyst en afvigelse fra de ideelle værdier i deres datablade, som er blevet accepteret. Andre komponenter, herunder modstande og kondensatorer, er blevet målt og tilpasset til systemet for at minimere afvigelserne, så vidt det var muligt. 

\subsection{Problemløsning}
Ved design, simulering, implementering og test af systemets enkelte kredsløb ses det, at alle overholder de fastsatte krav og tolerancer. Der er imidlertid nogle områder indenfor de enkelte blokke og spændingsforsyninger, hvor det kan overvejes, om der kunne have været anvendt andre metoder.

\subsubsection{Referencespænding til offset}
Implementeringen af en referencespænding til at forsyne offsetkredsløbet medfører tilføjelse af ekstra komponenter til det samlede system, og dermed også flere kilder til støj. Dette vurderes imidlertid til at være den mest optimale løsning sammenlignet med at anvende eksempelvis et batteri, da dette ikke kan anvendes som reference pga. det konstante spændingsfald. Der er stadig en uløst problematik ift. referencespændingen, da det stadig, jævnfør afsnit \ref{subsec:Spaendingsref} på side \pageref{subsec:Spaendingsref}, er batterier der fungerer som spændingsforsyning til referencespændingen. Dermed sker der stadig et gradvist fald i den spænding som batterierne kan yde, hvormed der med tiden heller ikke kan leveres en tilstrækkelig spænding fra referencen. Dette kan have konsekvenser ift. at få justeret offsettet korrekt. Det kan derfor være hensigtsmæssigt at tilføje en funktion, der oplyser brugeren om, når referencen ikke længere kan udsende den forventede spænding pga. batterierne i spændingsforsyningen. Hvis referencespændingen falder tilstrækkeligt, vil det have en fatal effekt for hele systemet.

\subsubsection{Opsamling}
I opsamlingblokken bliver offsettet fra accelerometret ved $0$g påvirkning justeret til $0$V jævnfør afsnit \ref{Offset_Teori_Design} på side \pageref{Offset_Teori_Design}. Da formålet med blokken i denne sammenhæng er at fjerne offsettet helt, kan det være en mulighed at anvende et højpasfilter, som dæmper frekvenserne fra offsettet.\fxnote{NTK: Når accelerometeret detekterer offsetværdien er påvirkningen $0$g, hvilket udgør de laveste frekvenser i signalet. Disse kan identificeres og dermed dæmpes med et højpasfilter, således at offsettets frekvenser er dæmpede på det samlede signal.} Ved denne løsning skal det imidlertid overvejes, at frekvenserne ikke fjernes helt, og det kræver derfor, at de er dæmpet tilstrækkeligt til, at de ikke har indflydelse på det samlede signal. Det kan desuden overvejes, om det vil være mere optimalt at sammenlægge offsetjusteringen og forstærkningen i opsamlingsblokken til ét kredsløb, hvilket kan forsimple blokken og dermed begrænse visse afvigelser, da der indgår færre komponenter. Denne løsning er imidlertid ikke valgt, da der i dette projekt ønskes en tydelig afgrænsning imellem de enkelte kredsløb for at gøre systemet mere overskueligt og sikre, at det muligt at identificere eventuelle fejl. 

\subsubsection{Filter}
På baggrund af beregninger blev det bestemt, at der skulle udarbejdes et 3. ordens lavpasfilter for at dæmpe uønskede frekvenser i det opsamlede signal. Kondensatorerne i kredsløbet blev valgt ud fra, hvad der var til rådighed i laboratoriet, og modstandene blev efterfølgende udregnet ud fra disse. I praksis ville det have været mere hensigtsmæssigt at afprøve flere forskellige kondensatorer og vælge dem, der gav den mindste afvigelse for modstandene.
Jævnfør afsnit \ref{Filter_afsnit} på side \pageref{Filter_afsnit} blev der valgt at anvende et Butterworth filter for at opnå maksimal fladhed i pas- og stopbåndet. Hvorvidt dette er blevet opfyldt vides ikke, og det kunne derfor have været testet for at få endnu en parameter, der beskriver kvaliteten af det udarbejdede filter. Det kunne desuden have været hensigtsmæssigt at teste de andre filtertyper for at kunne træffe et mere kvalificeret valg ift. hvilket filter, der er mest optimalt til dette system. \\  
Ved simulering af filteret med de beregnede modstande opstod nogle afvigelser i pasbåndsfrekvensen, som lå over de fastsatte tolerancer. Dette problem blev imidlertid løst, da de udregnede modstande under simuleringen blev erstattet med de teoretiske værdier for de reelle modstande, som skulle indgå i implementeringen af kredsløbet. Årsagen til dette er ukendt, da simulering med de præcise udregnede værdier burde give de mindste afvigelser, men det blev besluttet at acceptere blokken, da de reelle modstande også kunne bruges i implementeringen uden yderligere afrunding.

\subsubsection{Tilpasning}
I tilpasningsblokken bliver signalet i det nuværende system tilpasset til være $\pm3$V ved $\pm25^{\circ}$. Jævnfør afsnit \ref{Forstaerker_faktor3_afs} på side \pageref{Forstaerker_faktor3_afs} vurderes det, at en hældning over denne værdi ikke vil være relevant ift. at vurdere, hvorvidt patienten er faldet eller ej. Dette kunne imidlertid være blevet undersøgt nærmere, for at underbygge denne vurdering yderligere. En eventuel variation fra denne fastsatte værdi vil betyde, at forstærkningsfaktoren skal ændres.  

\subsubsection{Spændingsreference til komparator}
Spændingsreferencen til feedbackkonfigurationen er opbygget efter de samme principper som referencen til offsettet er opbygget. Forskellen er, at der ved udregningen af modstandene til dette afsnit er taget højde for, at flere komponenter kræver forsyning. Der er derfor her samme problematik som for spændingsreferencen til offsettet; Da spændingsforsyningen til referencen er udgjort af batterier, vil referenceværdien med tiden ikke kunne opretholdes. For feedbackenkonfigurationen vil dette det betyde en afvigelse i tærskelværdierne i de enkelte komparatorer, hvorfor der ikke længere vil udløses feedback ved de rigtige hældningsgrader. Det vil derfor også her være essentielt med en indikation til brugeren om at referencespændingen ikke længere ligger på den krævede værdi. 

\subsubsection{Feedbackkonfiguration}
Det kan være kompliceret at give feedback til patienter med følger af apopleksi, da de kan have kognitive problemer jævnfør afsnit \ref{Personlige_foelger} på side \pageref{Personlige_foelger}. Det skal derfor vurderes, hvorvidt flere typer feedback ad gangen er hensigtsmæssigt for patienterne, samt hvordan feedbacken anvendes. Det vurderes, at den visuelle feedback vil være essentiel for patienterne i begyndelsen af rehabiliteringsforløbet. Dette skyldes, at farverne tydeligt viser, hvilket område patienten befinder sig indenfor, samt hvilken retning hældningen sker i. Desuden er feedbacken sammensat ud fra samme princip som et lyskryds, hvilket er et kendt system for patienten. Dette hjælper til at lære systemet og dets anvendelse at kende og stiller ikke store krav til patientens evne til at fokusere på feedbacken. Den somatosensoriske feedback vil være at foretrække for patienter, som er længere i rehabiliteringsforløbet og har forbedret balance. Denne feedbackform stiller større krav til patienten end den visuelle feedback, da hældningsintervallerne ikke er tydeligt afgrænset. Derudover er der ingen feedback vedrørende patientens udgangsposition, da der ikke er vibration ved den grønne LED så patienten skal have fornemmelse for stabil udgangsposition. Desuden er der kun én vibrationshastighed, hvilket gør at patienten ikke får feedback om personen er i advarsels eller risikofasen. De to feedbackformer er adskilt fra hinanden i systemet, hvormed det i praksis vil være muligt at vurdere hvilken feedbacktype, der skal anvendes til den enkelte patient.\\

Det bør ift. den somatosensoriske feedback vurderes, hvilken side der er mest hensigtsmæssig at udløse feedbacken i; Det kan i praksis undersøges, om det virker bedst for patienterne at vibrationen udløses i samme side som hældningen sker til, eller om det fungerer bedre, at vibrationen sker i modsatte side. Hvis den sidste mulighed er mest optimal, vil løsningen være at sætte vibratorene omvendt på patienten. 
Det kan desuden overvejes, om der kan implementeres en tredje feedbackform, audiotiv feedback, hvor patienten advares vha. lyde, der angiver hældningsgraden. Denne feedbackform kan umiddelbart være vanskelig at anvende, da apopleksipatienter, jævnfør afsnit \ref{Krav_biofeedback} på side \ref{Krav_biofeedback}, ofte er ældre og derved kan have nedsat hørelse. Derudover kan betydningen af lydene være svær at huske, da det ikke er et system der i forvejen er indlært, som ved den visuelle feedback. \\
Accelerometeret skal under træningen være placeret øverst på sternum. Det kan i denne forbindelse overvejes, om der ved målingerne forekommer støj fra kroppen; eksempelvis i form af påvirkning fra hjerte og lunger.

Testen af feedbackkonfigurationen blev foretaget ved brug af oscilloskop, hvor de målte tærskelværdier blev sammenlignet med den værdi, hvor LEDen og vibratoren tænder, hvilket kan ses ved et spændingsfald. Oscilloskopen har indbygget en otte bit ADC-konverter, for at målingerne kan afbilledes digitalt. Denne kovertering gør at oscilloskopet har en gråzone mellem målepunkterne, som er på ca. $0.04$V. I denne gråzone vil oscilloskopet ikke kunne vise den præcise værdi. Da flere af tærskleværdierne samt spændingsfaldene for LED og vibratorne ligger i denne gråzone, var det vanskeligt at måle den nøjagtige forskel på værdierne. Derved er testen af komparatoren foretaget ved at tilnærme tærskelværdierne, samt værdien for spændingsfaldet, til det nærmeste målepunkt. Denne metode er mere problematisk ved tærskelværdien for den grønne LED end ved den røde LED, da $0.04$V undgør en størredel af selve tærskelværdien, hvilket ses på \ref{Tab:test-taendsluk}  på side \pageref{Tab:test-taendsluk}, hvor værdien for -$2\circ$ afviger med $15.72$\%. Ved denne målingen var tærskelværdien -$0.2373$V, hvilket er placeret i gråzonen, som går fra $0.200$V til $0.240$V og det samme var spændingsfaldet. Her blev spændingsfaldet tilnærmet målepunktet på $0.200$V, da det blev vurderet at den lå nærmest. 

En anden målemetode, hvori der ikke bruges en vurdering i gråzone undgås ved at opsætte et spændingstræ, der fungerer som to spændingsdeler med et potentiometer, der erstatter den miderste modstand. For at have en fast spænding kan spændingsreferncen på $2.5$V bruges. De to spændingsdeleres tærskelværdier kan udarbejdes således at de danner et arbejdsområde, hvor der manuelt kan menureres vha. potentiometeret. Der kan tilkolbles et multimeter, for mere nøjagtigt at kunne se, den reelle værdi i arbejdsområdet f.eks. kunne arbejdsområdet være mellem $0.200$V og $0.300$V, og da potentiometerret kan drejse 10 omgange, vil der pr. omgang kunne justeres med $0.010$V og derved vil gråzonen blive mindre end ved brug af oscilloskop. Gråzonen afhænger ved denne metode af hvor præcis værdierne er i spændingstræet. Denne præcision afhænger af modstandene der benyttes. Desuden afhænger metoden af multimeteres nøjagtighed ift. den værdi der måles og den værdi, der vise på interfacet.   

\subsubsection{ADC}
I resultaterne fra testen af ADC'en konkluderes det, at en for lav samplingsfrekvens ift. signalet medfører et kantet signal. Dette gøres på baggrund af de grafer, som fremkommer ved målingerne jævnfør afsnit \ref{ADC_afsnit} på side \pageref{ADC_afsnit}. For at underbygge denne konklusion kunne det have været en mulighed at foretage endnu en test, hvor inputsignalets frekvens øges yderligere. Hvis resultatet af denne måling skal stemme overens med den nuværende konklusion, skal grafen for den nye måling være mere kantet, som et udtryk for at der opsamles for få datapunkter til at der kan opnås et repræsentativt resultat.

\subsubsection{USB-isolator}
Da der ikke er udført en decideret test af USB-isolatoren og den opfylder de opstillede krav jævnfør afsnit \ref{USB_afsnit} på side \pageref{USB_afsnit} vurderes det, at der ikke er nogle væsentlige faktorer, der bør overvejes ift. denne blok.

\subsubsection{Computer}
For at kunne anvende softwaren kræver det at patienterne har en computer med programmet Matlab, mens det er muligt for alle computere at åbne den optagne fil, da dette er gemt som en billedefil. På denne måde kan patienten eller plejepersonalet videre sende dataen til alle som det kunne være relevant for. Det er ikke muligt at manipulere med grafen, da det er en billedefil, hvilket stiller en rækkekrav til ,at softwaren beregner og viser de nødvendige oplysninger for f.eks. plejepersonalet. En anden mulighed kunne være at filen blev gemt i Matlab, hvilket gør at plejepersonalet kan manipulere med grafen efter at filen er gemt, dette kræver at personer som modtager filen skal have installeret programmet Matlab. Det er nødvendigt for patienterne at have en anden person til rådighed under øvelsen, som kan starte og stoppe optagelsen, hvilket gør at systemet ikke er selvstændigt. For at systemet gøres selvstændigt kan der være en forsinkelse på optagelsen eller patienten kan have en stoppe- og starts funktion placeres omkring accelerometeret.

\subsubsection{Spændingsforsyning}
Jævnfør afsnit \ref{Spaendingsforsying} på side \pageref{Spaendingsforsying} anvendes spændingsforsyningen til at forsyne hhv. spændingsreferencerne samt de øvrige blokke i systemet. På baggrund af teori og tests fremgår det, at det er essentielt at spændingsforsyningen leverer den forventede spænding, da det ellers vil påvirke hele systemets funktion. Det kan dermed også være en fordel at tilføje en funktion til systemet der informerer brugeren, når spændingsforsyningen ligger under den forventede værdi. 
 
\subsection{Det samlede system}
På baggrund af den samlede systemtest af den analoge del af systemet ses det, at der er afvigelser for samtlige grader, hvor LED'erne samt vibratorerne aktiveres ift. de definerede grader. Der ses i \eqref{eq:graderLED_1}-\eqref{eq:graderLED_2} på side \pageref{eq:graderLED_1}, at den maksimale afvigelse i grader er $13^{\circ} - 11.22^{\circ} = 1.78^{\circ}$, hvilket svarer til $13.69\%$. Der forekommer således en højere procentmæssig afvigelse i denne test sammenlignet med de udregnede afvigelser for test af de enkelte blokke. Det vurderes, at denne afvigelse altså kan forventes grundet afvigelser i de enkelte blokke. Hvis der f.eks. tages udgangspunkt i outputtet fra accelerometret ved aktivering af den røde LED i positiv retning, som var $1.6740$V, kan afvigelserne for dette signal beregnes, hvis der tages højde for afvigelsen i referencespændingen til offsetjusteringsblokken. Dette ses i de følgende ligninger.
\begin{eqnarray}
1.6740 - 1.6302 = 0.0438 \\
\dfrac{0.0438}{0.0037} = 11.84^{\circ}
\end{eqnarray}
Der ses i ligningen, at den udregnede vinkel for accelerometret er $11.84$ grader, når der tages højde for referencespændingen. Derved er afvigelsen i grader $13^{\circ} - 11.84^{\circ} = 1.16^{\circ}$, hvilket er $8.92\%$ afvigelse fra $13^{\circ}$. Derved nedsættes afvigelsen, når der tages højde for de enkelte blokkes afvigelse i test. Flere af de benyttede komponenter har et indbygget offset, som f.eks. operationsforstærkere, hvormed dette også kan påvirke både de enkelte blokke og det samlede system. Der forventes ikke, at afvigelsen for det samlede system vil forsvinde helt, selvom der tages højde for blokkenes individuelle afvigelse, da der også skal medregnes eventuelle fejl ved målemetoderne ift. aflæsning eller upræcist udstyr. \\
Det kan også diskuteres, hvorvidt aflæsningen af accelerometrets output under den samlede test er foretaget korrekt, da outputtet blev aflæst ved forsøgsafviklernes vurdering af tidspunktet for udløst feedback. En mere præcis metode til dette vil eventuelt være at benytte et potentiometer. Dette kunne under test have erstattet accelerometret, hvorved det præcise output, der sendes ind i resten af systemet, kunne aflæses med et multimeter.\fxnote{NTK: potensiometret sættes op i en spændingstre med to spændingsdelere på hver side, som angiver "arbejdsområdet". Der kan drejes 10 omgange på potensiometret, hvorved den kan fungere som en variabel forstærker inden for arbejdsområdet.} Derudover vil tidspunktet for udløst feedback være mere præcist, da spændingen fra potentiometeret er konstant og kan måles mere nøjagtigt. Ved anvendelse af potentiometeret vil der være flere tolerancer, som skal tages højde for, da designet er mere omfattende. \\
\clearpage