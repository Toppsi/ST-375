% !TeX spellcheck = da_DK
\section{Kravspecifikationer}
%For at gøre anvendelse af samme system muligt til 4. Semester skal arbejdsområdet kunne benyttes sammen med et USB-baseret trådløst udviklingsværktøj eZ430-RF2500 fra Texas Instruments. Det er derfor nødvendigt, at designet stemmer overens med udviklingsværktøjet for at kunne sende og modtage data til og fra computeren. Udviklingsværktøjet indeholder hardware og software som evaluerer mikrokontrolleren MSP430F2274. For at hele vores system kan anvendes med udviklingsværktøjet, skal outputsignalet være 0-3V, eftersom mikrokontrolleren opererer med spændingsforsyning mellem 1,8V og 3,6V. \\
I praksis er det ikke muligt at have ideelle komponenter \cite{Nilsson2011}. Der vurderes derfor ud fra et pilotforsøg, litteratur og accelerometerets datablad hvilke krav de blokke i blokdiagrammet skal opflyde og den tolerance, der accepteres ift. forskellige parametre.

%\subsubsection{Det samlede system}
%Systemet skal ved sammenligning af inputtet fra et flerakset accelerometeret og output fra dioder samt vibration give et analogt output. På denne måde vil aktivering af bestemte LED-dioder og vibratorer afspejle inputsignalet, således at et input ved en bestemt hældningsgrad aktivere en gul LED-diode og vibration, mens yderligere hældning vil aktivere en rød diode og øge vibrationshastigheden. Derimod vil et input hvor opretholdelsen af balancen er korrekt, dvs. en hældningen der ligger under risikizonen aktivere den grønne LED-diode. Derudover vil det kunne bestemmes, hvilken retning patienten falder mod pga. accelerometerets 3 output akser, der kan måle i negativ og positiv retning. 

\subsection{Overordnede funktionelle krav til systemet:}
\begin{itemize}
	\item Systemet skal være brugervenligt, så det kan anvendes af apopleksipatienter og fagkyndigt personale
	\item Systemet skal kunne måle kropshældning, samt angive hvilken retning hældningen sker mod. Derudover skal det kunne måle statisk acceleration, eftersom vi måler på stående position \fxnote{skal sidste sætning med - referer til Erikas rettelse på side 4 fra statusseminar "skal kunne måle statisk acceleration" - hvorfor?}.
	\item Systemet skal kunne give visuel og somatosensorisk feedback ved forskellige hældningsgrader.
	\begin{itemize}
		\item Grøn diode: Skal lyse, når patienten ikke er ude i risikozonerne.  
		\item Gul diode: Skal lyse, når den første risikozone defineret i grader indtræffer og slukke, hvis patienten retter sig op.
		\item Rød diode: Skal lyse, når den anden risikozone defineret i grader indtræffer og slukke, hvis patienten retter sig op.
		\item Vibration: Skal aktiveres, når den første risikozone indtræffer og skal slukke, hvis patienten retter sig op. Hvis patienten hælder yderligere, skal vibrationshastigheden stige.
	\end{itemize}
	\item Systemet skal kunne skifte mellem to sværhedsgrader, hvilket vil sige, at systemet skal kunne skifte imellem to forskellige komparator blokke, som har tærskelværdier relateret til sværhedsgraden af den udførte øvelse.
	\item Signalet i systemet må ikke forstærkes til en værdi over 3V, da det så vil nå mætning.
	\item Systemet skal kunne give et digitalt outout, så det er muligt at behandle og gemme patienternes data i et program.
\end{itemize}

\subsection{Opsamling}
Blokken opsamling omfatter systemets sensor dvs. accelerometeret. Accelerometeret skal have en sådan størrelse, at det kan påsættes en patient uden at give fysiske begrænsninger. Derudover skal accelerometeret have mindst en akse, da der måles i det frontale plan. %Desuden skal det være flerakset, så det bliver muligt at påsætte i en optimal position, der giver mindst støj. 
Accelerometeret skal kunne måle en statisk acceleration i mindst en retning. Herved kan det bestemmes, hvilken retning patienterne hælder mod i stående position.  %Derudover skal det kunne detektere hældningsgraden af patienten. Dette gøres ud fra tyngdekraften, hvor accelerometeret giver et output i mV alt efter påvirkningen fra tyngdekraften, også kaldet statisk acceleration. Dette output vil kunne omregnes til grader. 
Det skal kunne detektere en hældningsgrad op til $\pm$ 90$^{\circ}$ \fxnote{180 grader range, men en tærskel på 8 grader - kan det blive problematisk (vi kommer til at arbejde med meget små værdier for de 6 grader)}, så det er muligt at detektere om patienten er faldet. \\
%For at kunne adskille det ønskede signal fra diverse støjkomponenter skal signalet forstærkes således at der kan skelnes mellem disse når signalet filtres. Da signalet allerede ligger inden for arbejdsområdet, er det ikke nødvendigt at forstærke amplituden af signalet. En forstærkning af signalet med et gain på 1, vil gøre at noget af den støj der indgår i signalet vil blive frasorteret, da de to kredsløb vil blive adskilt.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\textbf{Krav:}
\begin{itemize}
\item Skal mindst have en output akse, da der udelukkende måles i det frontale plan.
\item Skal være under $5x5$ cm i dimensionerne, da dette gør implementeringen på patienten nemmere.
\item Skal kunne måle statisk acceleration i mindst en retning.
\item Skal kunne detektere en hældning fra $\pm 0^{\circ}$ til $\pm 90^{\circ}$.
\item Skal give et outputsignal i elektrisk spænding målt i volt \fxnote{I hvilken range?}.
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
\item Tolerance krav vil blive beskrevet på baggrund af pilotforsøg.
%\item Hældningen skal have en lille tolerance for ikke at risikere at patienten ikke vil falde og sikre at man ikke bevæger sig ud i den næste risikozone uden at der 
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\subsubsection{Forstærker} \fxnote{Forsyningsspænding? - input/output range?}
%\textbf{Krav:}
%\begin{itemize}
%\item Skal forstærke signalet med et gain på 1.
%\item Skal have en indgangsimpedans på over 1m$\Omega$.
%\end{itemize}
%\textbf{Tolerance:}
%\begin{itemize}
%\item Tolerance krav vil blive beskrevet på baggrund af pilotforsøg.
%\item Der må være en afvigelse i indgangsimpedans på 5\%.
%\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Filter}\label{FilterAfs}
Blokken indeholdende et filter anvendes til at frasortere uønskede signaler, der kan forekomme under målinger med accelerometeret. Hvis disse signaler ikke frafiltreres vil det forvrænge det ønskede biologiske signal og opleves som støj. Frekvensområdet for kropshældning er ikke defineret, men studier anvender et frekvensområde liggende mellem 0.02 til 10 Hz \cite{Martinez-Mendez2011}. Alle signaler, der ligger udenfor dette spektrum, ønskes derfor fjernet. I pilotforsøget kan det påvises, hvor meget støj der er over 10 Hz og skal frafiltreres. Dette gøres ved at benytte et lavpasfilter, der har en knækfrekvens ved 12 Hz. \\
Som beskrevet i \ref{StoejAfsnit} på side \pageref{StoejAfsnit} findes der forskellige støjkilder, som kan påvirke biologiske signaler. \\
SKRIV NOGET OM DÆMPNING OG UDREGNE A-MIN HER, HVIS DET SKAL MED HER.\\
\textbf{Krav:}
\begin{itemize}
\item Skal have en knækfrekvens på 12 Hz.
\item Skal have en stopbåndsfrekvens på 45 Hz.
\item Der ønskes maksimal fladhed på pasbåndet og stopbåndet.
\item DÆMPNING! LSB...
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
\item Der accepteres en afvigelse fra knækfrekvensen på $\pm$ 10\%.
\item Der accepteres en afvigelse fra stopbåndsfrekvensen på $\pm$ 10\%.
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Tilpasning} \fxnote{implementering af noget offset, hvis vi overhovedet skal have det med}
Blokken tilpasning har til formål at tilpasse det filtrerede signal fra accelerometeret til ADC'en, der har et arbejdsområde fra 0 til 3V, og komparatoren. Dette gøres med en variabel forstærker, som sørger for, at signalet ikke kommer udenfor arbejdsområdet. \fxnote{Hvad skal den variable forstærkning være?}. \\
\textbf{Krav:}
\begin{itemize}
\item Skal kunne dæmpe amplituden af signalet, hvis det ligger over 3V.
\item Skal kunne forstærke amplitude af signalet, hvis det ligger under 0V.
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
\item Der accepteres ingen afvigelse.
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Komparator} \fxnote{det at vi har et range på 180 grader gør, at vi skal regulere meget fint i tærskelværdierne. Kan dette påvirke designet af systemet?}
Blokken indeholdende en komparator skal kunne sammenligne inputsignalet fra accelerometeret med en referencespænding og kunne modtange et signal mellem 0 til 3V. Komparatoren skal vha. definerede tærskelværdier bestemme hvilken hældningsgrad patienten har og i hvilken retning vedkommende hælder mod. Der skal være flere tærskelværdier, så feedbacken kan gives i flere niveauer og forskellige sværhedsgrader. Dette gør systemet fleksibelt, så det kan benyttes af patienter på forskellige balanceniveauer.
SKRIV NOGET OM DE ENKELTE TRIN/TÆRSKELVÆRDIER KOMPARATOREN SKAL HAVE PÅ BAGGRUND AF PILOTFORSØGET. \\
%Komparatoren skal kunne tænde for en diode og en vibrator, som afhænger af hældningsgraden hos patienten. \\
\textbf{Krav:}
\begin{itemize}
\item Skal kunne skifte mellem sværhedgrad ved at ændre tærskelværdierne.
\item Skal have en forsyningsspænding på minimum 3V og maksimalt 9 V \fxnote{er dette korrekt}.
\item Skal kunne modtage et inputsignal på 0 til 3V.
\item Skal ved en bestemt spænding \fxnote{Hvilken spænding? - pilotforsøg} tænde for en diode og vibrator \fxnote{Hvor mange? Her skal der beskrive antal og tærskelværdierne til de enkelte niveauer}.
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
\item Der accepteres en afvigelse i tærskelværdien på $\pm$ 1\%.
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Visuel feedback}
Blokken med visuel feedback omfatter den del af systemet, der giver feedback til patienten vha. LED-dioder. Der skal i alt være fem LED-dioder: En grøn, der palceres i midten, en gul på hver side af den grønne diode og en rød diode på hver side af de gule dioder. Den gule LED-diode aktiveres, når patienten skal være opmærksom på sin kropshældning, da vedkommende har bevæget sig ud i intervallet $8^{\circ}$-$13^{\circ}$. Den røde LED-diode aktiveres, når patienten er over $13^{\circ}$ og derfor er i fare for at falde. Retningen af patientens kropshældning bestemmes vha. placeringen af LED-dioderne. LED-dioderne til højre for den grønne LED-diode indikerer at patienten er ved at falde til højre. Det samme gør sig gældende for fald til venstre. Spændingsforsyningen til LED-dioderne skal udgøres af 9V batterier.   
\\
\textbf{Krav:}
\begin{itemize}
\item Skal have en spændingsforsyning på 9V.
\item LED-dioderne skal informere patienten om hvilken retning kropshældningen sker i.
\item LED-dioderne skal informere patienten om risikoen for fald.
\item LED-dioderne skal kunne give et tydeligt lys.
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
\item Der accepteres en afvigelse i tærskelværdien på $\pm$ 1\% af LED-dioderne.
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Somatosensorisk feedback} 
Blokken med somatosensorisk feedback omfatter også den del af systemet, der giver feedback til patienten. Her vha. vibratorer. Der skal i alt være to vibratorer, som placeres i medialt på hver underarm. Vibrationen skal ske i modsatte side af hældning, så patienterne kan rette sig mod siden, hvor vibrationen gives. Vibratorerne skal give en bestemt vibrationshastighed ved bestemte hældningsgrader hhv. den gule og røde LED-diode. Hvis den gule LED-diode lyser, skal vibrationen være let og hvis den røde LED-diode lyser skal vibrationen være moderat. Spændingsforsyningen til vibratorerne skal udgøres af 9 V batterier.
\\
\textbf{Krav:}
\begin{itemize}
\item Skal have en spændingsforsyning på 9V.
\item Vibratorerne skal have to vibrationshastigheder.
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
\item Der accepteres en afvigelse i tærskelværdien på $\pm$ 1\% af vibratorerne.
\end{itemize}

%\subsection{feedback}
%Der skal være både visuel og sensorisk feedback i form af LED-dioder og vibratorer. Der skal være fem LED-dioder, en grøn, der indikerer midtpunkt, en gul diode på hver side af den grønne diode, en rød diode på hver side af den gule diode. Den gule diode skal begynde at lyse ved en bestemt hældningsgrad, der indikerer at patienten skal være opmærksom på sin balance. Den røde diode skal begynde at lyse ved en bestemt hældningsgrad, der indikerer at patienten er i fare for at falde. Dioderne til højre for den grønne diode, skal indikere at patienten falder til højre. Det samme gør sig gældende for fald til venstre. Den sensoriske feedback skal vibrere ved en bestemt hældningsgrad, samtidig med de enkelte dioder lyser. Hvis den gule diode lyser, skal vibrationen være let og hvis den røde diode lyser skal vibrationen være moderat. Der skal placeres en vibrator på højre side og venstre side af patienten, der skal indikere i hvilken retning patienten falder. Spændingsforsyningen til feedbacksystem skal udgøres af 9 V batterier. \\
%\textbf{Krav:}
%\begin{itemize}
%\item Skal have en spændingsforsyning på 9 V.
%\item Vibratorerne skal have mindst to vibrationshastigheder.
%\item LED-dioderne og vibratorerne skal informere patienten om hvilken retning hældningen sker.
%\item LED-dioderne og vibratorerne skal informere patienten om risikoen for fald.
%\item LED-dioderne skal kunne lyse kraftigt nok til at kunne ses på fem meters afstand.
%\end{itemize}
%\textbf{Tolerance:}
%\begin{itemize}
%\item Der accepteres en afvigelse i tærskelværdien på $\pm$ 2 \% af feedbacken.
%\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{ADC}
Blokken med en ADC anvendes i systemet, for at konvertere det analoge signal til digitalt. %Den skal kunne sample det forstærkede signal. 
ADC'ens inputsignal skal ligge fra 0 til 3V, da systemet skal kunne benyttes på fjerde semester. %Det anbefales, at en ADC der skal opsamle et signal fra en variabel forstærkning har en opløsning på 12-bit \cite{Zouridakis2003}.
SKRIV NOGET OM SAMPLINGSFREKVENS IFT. VORES PILOTFORSØG. HVAD ER VORES BÅNDBREDDE. Båndbredden på accelerometeret bestemmer hvilken samplingsfrekvens, der skal benyttes. I følge Nyquists sætning skal der samples med minimun det dobbelte af det biologiske signal. I praksis samples der med minimum det tidobbelte. \\
\textbf{Krav:}
\begin{itemize}
\item Skal kunne modtage et inputssignal i intervallet 0 til 3 V.
\item Skal have en samplingsfrekvens på minimum det tidobbelte af accelerometerets båndbredde.
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
\item Der accepteres ingen afvigelse ift. ADCen.
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{USB-isolator}
Blokken med USB-isolatoren anvendes i systemet for at øge patientens sikkerhed. USB-isolatoren isolerer patienten fra kredsløbet og sørger, at der ikke løber lækstrømme fra computeren ind i systemet.\\
\textbf{Krav:}
\begin{itemize}
\item Skal have den samme outputspænding som inputspænding. 
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
\item Der accepteres ingen afvigelse ift. USB-isolatoren. 
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%55
\subsection{Software}
Blokken indenholdende softwaren implementeres i systemet for at kunne beahndle og gemme patienternes øvelsesresultater. Denne del af systemet er brugerfladen for det fagkyndige personale og skal derfor kunne fremvise information omkring patienternes balance i form af grafer eller lignende. Det fagkyndige personale skal vha. af softwaren kunne følge med i patienternes udvikling ift. balancen. \\
\textbf{Krav:}
\begin{itemize}
\item Skal kunne fremvise information om patientens hældning i de enkelte øvelser, herunder hvor ofte patienten har bevæget sig ud i risikozonerne. 
\item Skal kunne gemme data.
%\item Skal være brugervenligt for det fagkyndige personale, dvs. designet af programmet skal være enkelt. 
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
\item Der accepteres ingen afvigelse ift. software. 
\end{itemize}
