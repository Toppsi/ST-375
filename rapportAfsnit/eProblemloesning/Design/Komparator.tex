% !TeX spellcheck = da_DK
\subsection{Komparator}
\subsubsection{Teori og design}
Som nævnt i afsnit \ref{Komparatorafsnit} på side \pageref{Komparatorafsnit} anvendes en komparator til at sammenligne to inputspændinger. I dette tilfælde vil komparatorens output blive tilkoblet hhv. en LED-diode eller/og vibrator, en modstand og den positive spændingsforsyning ($+V_{cc}$). I komparatorens inverterende terminal skal outputtet fra forrige blok tilsluttes. Inputtet til den ikke-inverterende terminal skal være reference spændingen, hvilket anvendes til at angive de beregnede tærskelværdier. Komparatoren kan derfor have to forskellige outputs afhængig af inputspændingen. Hvis inputsignalet er mindre end den beregnede tærskelværdi, vil outputtet være $0V$, og dioderne og vibratoren vil ikke aktiveres. Er inputtet højere end tærskelværdien, vil outputtet svare til jord, da strømmen fra $+V_{cc}$ vil løbe igennem komparatoren og derefter til jord. Derved opnås et spændingsfald over den positive og negative pol for LED-dioden og vibratoren på en værdi, der ligger over det minimale spændingsfald, der kræves for en aktivering. LED-dioderne og vibratorerne vil derved blive aktiveret og give feedback til patienten. \\
Diodernes katode skal tilkobles komparatorens output, hvorimod dens anode skal tilkobles $+V_{cc}$. For aktivering af LED-dioderne vil der blive anvendt fem komparatorer, da der ifølge kravspecifikationerne i afsnit \ref{KomparatorAfs} på side \pageref{KomparatorAfs} er fem forskellige stadier for aktivering. Tærskelværdierne for disse implemeteres vha. fem parallelforbundede modstande (R1-R5) og en spændingsreference $+V_{ref}$. Derudover placeres fem modstande (R6-R10) mellem LED-dioderne og $+V_{cc}$ for at beskytte LED-dioderne mod for høj strømstyrke og undgå, at batteriet drænes. På \figref{Fig:grund_kompar} ses systemet.\\

%\begin{figure}[H]
%	\centering 
%	\includegraphics[scale=0.9]{figures/cProblemloesning/}
%	\caption{På figuren ses komparatorkonfigurationen, som er opbygget af fem komparatorer, der består af fem spændingskomparatorer (LT1011) samt fem modstande og operationsforstærkere i en inverterende konfiguration (U1-U5). Derudover ses et spændingstræ bestående af fem modstande (R1-R2) og en spændingsreference $+V_{ref}$. Hertil er fem lysdioder og modstandere (R6-R10) koblet. }
%	\label{Fig:grund_kompar}
%\end{figure}

\noindent\textbf{Beregning af tærskelværdier og tilhørende R1-R5 modstande for aktivering af LED-dioder} \\
Inputsignalet fra forrige blok, som er tilpasningsblokken, vil være et signal, der ligger imellem -$3.9906$V og $4.0662$V jævnført afsnit \ref{KomparatorAfs} på side\pageref{KomparatorAfs}. Ifølge systemets funktionelle krav i afsnit \ref{FunkKrav} på side \pageref{FunkKrav} ønskes det, at LED-dioderne skal lyse ved en bestemt kropshældning, dvs. ved en bestemt tærskelværdi. %Disse tærskelværdier sættes ud fra to punkter; det maksimale teoretiske signal  ved $25^{\circ}$ $4.0662$, og en tilgængelig spændingsreference, der kan sørge for en fast spænding til spændingstræet. 
Tærskelværdierne er som jævnført afsnit \ref{KomparatorAfs} udregnet til at være:
\begin{itemize}
\item $2^{\circ}$ = $0.324$V
\item -$2^{\circ}$ = -$0.324$V
\item $8^{\circ}$ = $1.314$V
\item -$8^{\circ}$ = -$1.2744$V
\item $13^{\circ}$ = $2.1168$V
\item -$13^{\circ}$ = -$2.0736$V
\item $25^{\circ}$ = $4.0662$V
\item -$25^{\circ}$ = -$3.9906$V
\end{itemize}

Der vælges en justerbar mikropower spændingsreference (shunt-reference LM385), som skal levere minimum $4.0662$V til spændingstræet ved et ideelt kredsløb, men skal i praksis kunne levere mere. Spændingsreferencen indgår som del af en variabel spændingsdeler og bruges hvis spændingen falder over tid, da der anvendes et $9$V batteri som spændingsforsyning. Modstandene (R1-R5) mellem spændingsreferencen og batteriet har til formål at sørge for, at batteriet ikke drænes, fordi kredsløbet trækker strøm. Hvis modstanden er høj, vil strømmen til kredsløbet være lav, og batteriet vil derved holde længere. Modstanden beregnes ud fra Ohms lov, hvor strømmen, som skal videre til spændingsreference og spændingstræet, sættes til at være $0.1$mA. Denne værdi vælges, da spændingsreferencen forbruger mellem $10\mu$A til $20$mA, og der skal være noget strøm til spændingstræet og tilhørende komparatorer. Spændingsfaldet over modstanden beregnes til at være;

\begin{equation}
7V - 4.0662V = 2.9338V   
\end{equation}
Hvor de $7$V er den spænding der minimum skal leveres, og de $4.0662$V er den højeste tærskelværdi, dvs. den 


- Beregninger af referencespændinger - se datablad \\
- beregninger af modstande \\


\noindent\textbf{Beregning af R6-R10 modstande for aktivering af LED-dioder} \\
Ifølge kravspecifikationerne i afsnit \ref{FunkKrav}  på side \pageref{FunkKrav} for komparatoren skal den have en forsyningsspænding på minimum 3V og maksimalt 9V. De anvendte LED-dioder i systemet er: en L-53LG 5mm (grøn), to L-53LI 5mm (rød) og to L-53LY 5mm (gul). Disse LED-dioder kræver en minimum spænding på 2mA for at lyse og spændingsfaldet over dioderne ligger maksimalt i intervallet 2,0 til 2,2 V (rød: 2,0, gul: 2,1 og grøn: 2,2), men typisk mellem $1.7$V-$1.9$V. LED-dioderne forsynes af et 9V batteri og tilkobles, som sagt, tilhørende modstande for bla. at undgå at LED-dioderne brænder af. Spændingsfaldet over dioderne samt den spænding LED-dioderne som minimum skal bruge for at lyse er kendte værdier, dvs. modstandene R6-R10 kan derfor findes vha. Ohms lov. Nedestående udregning giver en værdi af modstandene, hvis batteriet yder maksimal spænding:

\begin{equation}
\text{R} = \dfrac{9V - 2.2V}{2mA} = 3500\Omega
\end{equation}

\noindent I praksis vil batteriet ikke yde en maksimal spænding på $9$V, da spændingen aftager som funktion af tiden. Da det i praksis er påkrævet, at batteriet forsyner kredsløbet med minimum $7$V, og dioderne kan forsynes med op til $150$mA, før de brændes af, kan samme udregning laves, for at bestemme den lavest mulige modstandsværdi for R$6$-R$10$:
\begin{equation}
R_{min} = \dfrac{7V-2.2V}{2mA} = 2400\Omega
\end{equation}

\noindent Dermed sættes modstandene R$6$-R$10$ alle til $2400\Omega$ for at sikre at der er tilstrækkeligt med strøm i kredsløbet til at dioderne kan lyse, uden at de brændes af eller at batteriet drænes. 

\noindent\textbf{Beregning af tærskelværdier og tilhørende R1-R5 modstande for aktivering af  vibratorerne} \\
For aktivering af vibratorerne vil der blive anvendt to komparatorer, da der ifølge kravsspecifikationerne i afsnit \ref{KomparatorAfs} på side \pageref{KomparatorAfs} skal være 2 tærskelværdier. Disse tærskelværdier konstrueres ligeledes vha. to parallelforbundede modstande og spændingsreferencer, samt de resterende modstande mellem vibratorerne og $+V_{cc}$. På figur X vises konstruktionen af kredsløbet med de to vibratorer og tilhørende modstande. \\

indsæt billede og word dokument \\

\noindent\textbf{Beregning af R6-R10 modstande for aktivering af vibratorerne} \\
Vibratorerne der anvendes i systemet er af typen XX... Afsnit skal skrives, når vi har information om vibratorer.  \\

FÅ SWITCH MED IND I DET? \\

\subsubsection{Simulering}
\subsubsection{Implementering og test}
