% !TeX spellcheck = da_DK
\section{Specifikke kravspecifikationer}
I praksis er det ikke muligt at have ideelle komponenter \cite{Nilsson2011}. Der vurderes derfor ud fra pilotforsøget, litteratur samt relevante datablade, hvilke krav blokkene i blokdiagrammet i afsnit \ref{kravblok} på side \pageref{kravblok} skal opfylde og den tolerance, der accepteres ift. forskellige parametre.

\subsection{Opsamling}\label{OpsamlingsAfs}
Blokken opsamling omfatter accelerometeret, offsetjustering og forstærkning. Accelerometeret skal have en sådan størrelse, at det kan påsættes en patient uden at give fysiske begrænsninger. Accelerometeret skal kunne måle en statisk acceleration i mindst to retninger, da der måles i det frontale plan til hhv. højre og venstre side. Herved kan det bestemmes, hvilken retning patienterne hælder mod i stående position. Det skal kunne detektere en hældningsgrad op til $\pm90^{\circ}$, da en forsøgsperson ikke kan komme over denne hældningsgrad. \\
Offsetjusteringen skal centrere det målte signal omkring $0V$, da accelerometeret typisk måler $1.6325V$ ved $0$g påvirkning af den pågældende akse ifølge pilotforsøget. Derfor skal der trækkes $1.6325$V fra alle inputs fra accelerometret. Justeringen af offset skal forekomme inden forstærkning således, at der ikke sker en forstærkning og dermed forskydning af offsetværdien, når accelerometret måler i positiv og negativ retning, hvorved g påvirkningen ændres. Ved justering af offsettet må der ikke ske en ændring af amplitudens peak-to-peak og frekvensen. \\
Forstærkningen skal gøre det nemmere at adskille det ønskede signal fra støj i den efterfølgende filtreringsblok. For at forstærkningskredsløbet ikke dræner strømforsyningen, skal inputimpedansen til forstærkeren være mindst $100$ gange større end outputimpedansen i accelerometeret som kan ses i afsnit \ref{Subsec:AccTeori} på side \pageref{Subsec:AccTeori}. Signalet skal efter forstærkningen ligge indenfor arbejdsområdet $\pm3V$ og der ønskes derfor størst mulige forstærkning. Den højeste måling ved $\pm90^{\circ}$ var ifølge pilotforsøget efter offsetjusteringen $0.3313$V. Derfor kan forstærkningen udregnes således:
\begin{equation}
\dfrac{3\text{V}}{0.3313\text{V}} =  9.05 \approx 9.1
\end{equation}
\noindent Der ønskes en forstærkning på faktor $9.1$. Derved vil den maksimale spænding efter denne forstærkning være $3.0148$V, hvilket accepteres, da der vides fra databladet for operationsforstærkeren TL081 og teori, at når TL081 bliver forsynet med en spænding på $5.5$V, så vil den maks give ca. $4$V ud. \cite{Corporation1995} Derfor vil en lille afvigelse i outputsignalet ift. arbejdsområdet ikke få systemet til at gå i mætning. Forstærkningens gain i dB udregnes ud fra følgende formel: 
\begin{equation}
20 \cdot log_{10} (9.1) = 19.1808\text{dB}
\end{equation} 

\noindent\textbf{Krav:}
\begin{itemize}
	\item Opsamlingsblokken skal have en spændingsforsyning på $5.5$V.
	\item Accelerometeret skal minimum have en output akse.%, da der udelukkende måles i det frontale plan.
	\item Accelerometeret skal være under $5x5$ cm i dimensionerne.%, da dette gør implementeringen på patienten nemmere.
	\item Accelerometeret skal kunne måle statisk acceleration i mindst to retninger.
	\item Accelerometeret skal kunne detektere en hældning fra $0^{\circ}$ til $\pm90^{\circ}$.
	\item Offsetjusteringen skal centrere det målte signal omkring $0V$.
	\item Forstærkeren skal have en indgangsimpedans på $3.68M\Omega$\fxnote{Da man ikke vil dræne blokken før for strøm. Udregnet ved 32Kohm, da indputimpedans skal være mindst $100$ gange større end den forrige bloks outputimpedans. Accelerometrets indgangsimpedans har en afvigelse på +15\%}.
	\item Forstærkningen skal være på $9.1$, som svarer til $19.1808$dB.
	\item Outputtet fra denne blok skal være mellem $2.9817$V og -$2.9097$V.
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
	\item Der accepteres en afvigelse i de benyttede modstandes reelle værdi på $\pm1\%$
	\item Der accepteres en afvigelse i detektionen af hældningsgrad på $\pm5\%$.
	\item Der accepteres en afvigelse af offsetjusteringen på $\pm2\%$.
	\item Der accepteres en afvigelse i forstærkningen på $\pm2\%$.
	\item Der accepteres en afvigelse ift. maksimum og minimum output fra blokken på $\pm5\%$.
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Filter}\label{FilterAfs}
Blokken indeholdende et filter anvendes til at frasortere uønskede signaler, der kan forekomme under målinger med accelerometret. Filtreringsblokken inddrages i systemet jævnfør afsnit\ref{Filterafsnit} på side \pageref{Filterafsnit}. Frekvensområdet for kropshældning er ikke klart defineret, men studier anvender et frekvensområde liggende mellem $0.02-10Hz$ \cite{Martinez-Mendez2011}. Alle signaler, der ligger udenfor dette spektrum, ønskes derfor fjernet. I pilotforsøget blev der påvist, at signalet i dette tilfælde ligger mellem $0-25Hz$. Alt signal uden for dette spektrum ønskes derfor frafiltreret. Dette gøres ved at benytte et lavpasfilter, der har en knækfrekvens ved $25$Hz. \\
Den maksimale variation i pasbåndstransmissionen ($A_{max}$) sættes til $3$dB. For fjerne $50Hz$ støj, sættes stopbåndsfrekvensen til $45$Hz, og der udregnes en faktor ud fra LSB \ref{ADCafsnit} og den maksimale amplitude af signalet. Den maksimale amplitude beregnes ved en Root Mean Square (RMS) analyse ud fra rotationerne foretaget i \ref{Sec:Pilotforsoeg} for hhv. højre og venstre side. Dæmpningsfaktoren udregnes ved følgende ligning:
\begin{equation}
\dfrac{0.00244\text{V}}{0.0162\text{V}} = 0.1506 \approx 0.2 
\end{equation}
\begin{equation}
\dfrac{0.00244\text{V}}{0.0131\text{V}} = 0.1863  \approx 0.2
\end{equation}
Der ønskes en dæmpning på faktor $\dfrac{1}{5}$, da der tages forbehold for et tolerance område. Dæmpningens gain i $dB(A_{min})$ udregnes ud fra følgende formel:   
\begin{equation}
A_{min}=20 \cdot log_{10} \cdot (\frac{1}{5}) = -13,98 \approx -14\text{dB}
\end{equation}
\textbf{Krav:}
\begin{itemize}
	\item Filtreringsblokken skal have en spændingsforsyning på $5.5$V.
	\item Skal kunne modtage et inputsignal på $\pm3V$.
	\item Der ønskes en knækfrekvens i pasbåndet på 25Hz.
	\item Der ønskes en stopbåndsfrekvens på 45Hz.
	\item Der ønskes maksimal fladhed på pasbåndet og stopbåndet.
	\item Der ønskes en minimum dæmpning af stopbåndet på 14dB.
	\item Der ønskes en maksimal dæmpnning i pasbåndet på 3dB.
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
	\item Der accepteres en afvigelse fra knækfrekvensen på $\pm10\%$.
	\item Der accepteres en afvigelse fra stopbåndsfrekvensen på $\pm5\%$.
	\item Der accepteres minimal dæmpning på 14dB af stopbåndet eller en afvigelse på $+15\%$.
	\item Der accepteres maksimal dæmpning på 3dB af pasbåndet eller en afvigelse på $-15\%$.
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Tilpasning}\label{Tilpasningsblok}
Blokken tilpasning har til formål at tilpasse det filtrerede signal til komparatoren. Dette gøres med en forstærker, således at spektret, der skal reguleres indenfor, øges. Derudover afgrænses måleintervallet til $\pm25^{\circ}$, da et range på $\pm90^{\circ}$ er unødvendigt ift. at vurdere hvorvidt patienten er faldet. Det vurderes, at en hældning på over $25^{\circ}$ medfører fald, da denne hældning ligger væsentligt ud over den naturlige hældningsgrad jævnfør afsnit \ref{BalanceAfsnit}, side \pageref{BalanceAfsnit}. Der ønskes størst mulig forstærkning indenfor det fastsatte arbejdsområde på $\pm3$V. Indgangsimpedansen bestemmes ud fra samme kriterier som for forstærkeren i opsamlingsblokken. I bilag \ref{Bilag:Pilotforsoeg} på side \pageref{Bilag:Pilotforsoeg} er den størst mulige spænding efter justering af offsettet udregnet, hvilket er $0.3313V$. Derudover er der det beregnet, at den maksimale volt pr. grad er $0.0037$V. Ved $\pm25^{\circ}$ vil outputtet være;
\begin{align}
\label{Udreg3} 0.0037 \cdot 25 = 0.0925V
\end{align}
Forstærkerens faktor samt gain i dB udregnes i \eqref{TilpasEq2} og \eqref{TilpasEq3}.
\begin{align}
\label{TilpasEq1} 0.0925V \cdot 9.1 = 0.8418V \\
\label{TilpasEq2} \dfrac{3V}{0.8418V} = 3.5638 \approx 3.6 \\
\label{TilpasEq3} 20 \cdot log_{10} (3.6) = 11.1261\text{dB}
\end{align} 
I \eqref{TilpasEq1}, \eqref{TilpasEq2} og \eqref{TilpasEq3} er de $3V$ grænsen for arbejdsområdet. Der forstærkes med en faktor $3.6$. \\

\noindent\textbf{Krav:}
\begin{itemize}
	\item Tilpasningsblokken skal have en spændingsforsyning på $5.5$V.
	\item Skal kunne modtage et inputsignal på $\pm3V$
	\item Forstærkningen skal være på $3.6$, som svarer til $11.1261dB$.
	\item Indgangsimpedansen skal være over $3.2M\Omega$.
	\item Output impedansen skal være under $32K\Omega$.
\end{itemize}
\noindent\textbf{Tolerance:}
\begin{itemize}
%	\item Der accepteres en afvigelse i indgangsimpedansen på ??
	\item Der accepteres en afvigelse i de benyttede modstandes reelle værdi på $\pm1\%$
	\item Der accepteres en afvigelse i forstærkningen på $\pm2\%$.
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Komparator}\label{KomparatorAfs} 
Blokken indeholdende komparatorer skal kunne sammenligne inputsignalet med referencespændinger og kunne modtage et signal mellem $\pm3$V. Komparatorerne skal vha. definerede tærskelværdier bestemme hvilken hældningsgrad patienten har og i hvilken retning vedkommende hælder mod. Der skal være flere tærskelværdier, så feedbacken kan gives i flere niveauer og forskellige sværhedsgrader. Dette gør systemet fleksibelt, så det kan benyttes af patienter på forskellige balanceniveauer. Tærskelværdierne er bestemt på baggrund af pilotforsøg, hvor værdierne er beregnet ved først at finde spændingen for $90^{\circ}$, som jævnført \ref{Sec:Pilotforsoeg} på side \pageref{Sec:Pilotforsoeg} er $0.2712$V for positiv retning og -$0.2660$V i negativ retning efter forstærkning på hhv. en faktor $10$ og derefter en faktor $3$. Denne værdi divideres med $90$ for at bestemme spændingen ved $\pm1^{\circ}$ og ganges herefter med hhv. $2^{\circ}$,  $8^{\circ}$, $13^{\circ}$ og $25^{\circ}$ for at bestemme spændingen ved de enkelte hældninger.\\
\textbf{Krav:} 
\begin{itemize}
	\item Komparatorblokken skal have en forsyningsspænding på  $\pm5.5$V.\fxnote{evt. rette dette til}
	\item Skal kunne skifte mellem sværhedsgrad ved at ændre tærskelværdierne.
	\item Skal kunne modtage et inputsignal på $\pm3$V. 
	\item Skal ved et bestemt spændingsinterval aktivere en diode og vibrator:
	\begin{itemize}
		\item Grøn diode og ingen vibration: I intervallet indenfor $0.1808$V til -$0.1773$V. Som svare til $\pm2^{\circ}$.
		\item Gul diode og let vibration: I intervallet fra $0.7233$V til $1.1753$V og intervallet fra -$0.7094$V til -$1.1527$V. Som svare til $\pm 8^{\circ}-13^{\circ}$.
		\item Rød diode og moderat vibration: I intervallet fra $1.1753$V til $2.2602$V og intervallet fra -$1.1527$V til -$2.2168$V. Som svare til $\pm13^{\circ}-25^{\circ}$.
		%\item Ingen feedback: Over $2.2602$V og under -$2.2168$V. 
	\end{itemize}
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
	\item Der accepteres en afvigelse i tærskelværdien på $\pm1\%$.
	\item Der accepteres en afvigelse i forsyningsspændingen på $\pm5\%$.
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Visuel feedback}
Blokken med visuel feedback omfatter den del af systemet, der giver feedback til patienten vha. LED-dioder. Der skal i alt være fem LED-dioder: En grøn, der placeres i midten, en gul på hver side af den grønne diode og en rød diode på hver side af de gule dioder. Den grønne LED-diode skal lyse, når accelerometret er placeret præcist på patienten, hvorved der er sikret den rette udgangsposition for hældningen. Dette gør, at den grønne LED-diode er aktiveret fra $0^{\circ}$-$2^{\circ}$. I intervallet $2^{\circ}$-$8^{\circ}$ lyser ingen LED-dioder. Den gule LED-diode aktiveres, når patienten skal være opmærksom på sin kropshældning, da vedkommende har bevæget sig ud i intervallet $8^{\circ}$-$13^{\circ}$. Den røde LED-diode aktiveres, når patienten er over $13^{\circ}$ og derfor er i fare for at falde. Retningen af patientens kropshældning bestemmes vha. placeringen af LED-dioderne. LED-dioderne til højre for den grønne LED-diode indikerer at patienten er ved at falde til højre. Det samme gør sig gældende for fald til venstre. 
\\
\textbf{Krav:}
\begin{itemize}
	\item Den visuelle feedbackblok skal have en spændingsforsyning på  $5.5$V.
	\item LED-dioderne skal informere patienten om hvilken retning kropshældningen sker i.
	\item LED-dioderne skal kunne informere patienten omkring accelerometerets placering.
	\item LED-dioderne skal informere patienten om risikoen for fald.
	\item LED-dioderne skal kunne give et tydeligt lys.
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
	\item Der accepteres en afvigelse i tærskelværdien på $\pm1\%$ af LED-dioderne.
	\item Der accepteres en afvigelse i forsyningsspændingen på $\pm5\%$.
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Somatosensorisk feedback} 
Blokken med somatosensorisk feedback omfatter også den del af systemet, der giver feedback til patienten. Her vha. vibratorer. Der skal i alt være to vibratorer, som placeres i medialt på hver underarm. Vibrationen skal ske i modsatte side af hældning, så patienterne kan rette sig mod siden, hvor vibrationen gives. Vibratorerne skal give en bestemt vibrationshastighed ved bestemte hældningsgrader hhv. den gule og røde LED-diode. Hvis den gule LED-diode lyser, skal vibrationen være let og hvis den røde LED-diode lyser skal vibrationen være moderat.
\\
\textbf{Krav:}
\begin{itemize}
	\item Skal have en forsyningsspænding på $5.5$V.
	\item Vibratorerne skal informere patienten om hvilken retning kropshældningen sker i.
	\item Vibratorerne skal informere patienten om risikoen for fald.
	\item Vibratorerne skal have to vibrationshastigheder\fxnote{Find evt. konkrete værdier - vi skal desuden måske kun have én hastighed}.
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
	\item Der accepteres en afvigelse i tærskelværdien på $\pm1\%$ af vibratorerne.
	\item Der accepteres en afvigelse i forsyningsspændingen på $\pm5\%$.
\end{itemize}

%\subsection{feedback}
%Der skal være både visuel og sensorisk feedback i form af LED-dioder og vibratorer. Der skal være fem LED-dioder, en grøn, der indikerer midtpunkt, en gul diode på hver side af den grønne diode, en rød diode på hver side af den gule diode. Den gule diode skal begynde at lyse ved en bestemt hældningsgrad, der indikerer at patienten skal være opmærksom på sin balance. Den røde diode skal begynde at lyse ved en bestemt hældningsgrad, der indikerer at patienten er i fare for at falde. Dioderne til højre for den grønne diode, skal indikere at patienten falder til højre. Det samme gør sig gældende for fald til venstre. Den sensoriske feedback skal vibrere ved en bestemt hældningsgrad, samtidig med de enkelte dioder lyser. Hvis den gule diode lyser, skal vibrationen være let og hvis den røde diode lyser skal vibrationen være moderat. Der skal placeres en vibrator på højre side og venstre side af patienten, der skal indikere i hvilken retning patienten falder. Spændingsforsyningen til feedbacksystem skal udgøres af 9 V batterier. \\
%\textbf{Krav:}
%\begin{itemize}
%\item Skal have en spændingsforsyning på 9 V.
%\item Vibratorerne skal have mindst to vibrationshastigheder.
%\item LED-dioderne og vibratorerne skal informere patienten om hvilken retning hældningen sker.
%\item LED-dioderne og vibratorerne skal informere patienten om risikoen for fald.
%\item LED-dioderne skal kunne lyse kraftigt nok til at kunne ses på fem meters afstand.
%\end{itemize}
%\textbf{Tolerance:}
%\begin{itemize}
%\item Der accepteres en afvigelse i tærskelværdien på $\pm$ 2 \% af feedbacken.
%\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Spændingsforsyning}
I systemet anvendes en spændingsforsyning af batterier placeret i en spændingsreference for at levere en konstant spænding til hele kredsløbet. Der anvendes batterier for at undgå tilslutning til elnettet, hvilket gør det mere sikkert og anvendeligt for patienten. Spændingsforsyningen kan havde indflydelse på hvilket outputsignal der opnås og det er derfor vigtigt at blokkene i systemet designes efter den fastsatte spænding. \\
\noindent\textbf{Krav:}
\begin{itemize}
\item Spændingsforsyningen skal være på $5.5$V.
\item Skal være forsyning for samtlige blokke i systemet.
\item Spændingsforsyningen må ikke forårsage klipning af signalet.
\end{itemize}
\noindent\textbf{Tolerance:}
\begin{itemize}
\item Der accepteres ingen afvigelse for spændingsreferencen.
%\item Der accepteres ingen spænding højere end dioderne kan tåle \fxnote{måske en anden måde det kan skrives på}
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{ADC}
Blokken med en ADC anvendes i systemet, for at konvertere det analoge signal til digitalt. %Den skal kunne sample det forstærkede signal. 
ADC'ens inputsignal vil ligge i området $\pm3V$, men der skal tages højde for afvigelser, så derfor skal ADC'en kunne modtage signaler på $\pm4V$. Båndbredden på accelerometeret bestemmer, hvilken samplingsfrekvens der skal benyttes. I følge Nyquists sætning skal der samples med minimun det dobbelte af det biologiske signals frekvens. I praksis samples der med minimum det tidobbelte jævnfør afsnit \ref{ADCafsnit}, side \pageref{ADCafsnit}. I dette tilfælde er båndbredden $50Hz$, dvs. at der som minimum skal samples med $100Hz$, og i praksis vil det være hensigtsmæssigt at sample med minimum $500Hz$. \\
\textbf{Krav:}
\begin{itemize}
	\item Skal kunne modtage et inputsignal i intervallet $\pm4$V.
	\item Skal have en samplingsfrekvens på minimum $500Hz$.
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
	\item Der accepteres ingen afvigelse ift. ADC'ens bearbejdning af signalet.
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{USB-isolator}\label{kravspecifikationer_USB}
Blokken med USB-isolatoren anvendes i systemet for at øge patientens sikkerhed. USB-isolatoren isolerer patienten fra kredsløbet og sørger, at der ikke løber lækstrømme fra computeren ind i systemet.\\
\textbf{Krav:}
\begin{itemize}
	\item Skal have en inputspænding på $\pm3$V.
	\item Skal have samme outputspænding som inputspænding. 
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
	\item Der accepteres en afvigelse på $\pm2\%$ for USB-isolatorens input- og outputspænding. 
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%55
\subsection{Software}\label{subsec:software}
Blokken indeholdende softwaren implementeres i systemet for at kunne behandle og gemme patienternes øvelsesresultater. Denne del af systemet er brugerfladen for det fagkyndige personale og skal derfor kunne fremvise information omkring patienternes balance i form af grafer eller lignende. Det fagkyndige personale skal vha. af softwaren kunne følge med i patienternes udvikling ift. balancen. \\
\textbf{Krav:}
\begin{itemize}
	\item Skal kunne fremvise data med information om patientens hældning i de enkelte øvelser, herunder hvor ofte patienten har bevæget sig ud i risikozonerne. 
	\item Skal kunne gemme data med information om patientens hældning.
	%\item Skal være brugervenligt for det fagkyndige personale, dvs. designet af programmet skal være enkelt. 
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
	\item Der accepteres ingen afvigelse ift. software. 
\end{itemize}