% !TeX spellcheck = da_DK
\section{Specifikke kravspecifikationer}
I praksis er det ikke muligt at have ideelle komponenter \cite{Nilsson2011}. Der vurderes derfor ud fra pilotforsøget, litteratur samt relevante datablade, hvilke krav blokkene i blokdiagrammet i afsnit \ref{kravblok} på side \pageref{kravblok} skal opfylde og den tolerance, der accepteres ift. forskellige parametre.

\subsection{Opsamling}\label{OpsamlingsAfs}
Blokken opsamling omfatter accelerometeret, offsetjustering og forstærkning. Accelerometeret skal have en sådan størrelse, at det kan påsættes en patient uden at give fysiske begrænsninger. Derudover skal accelerometeret have mindst en akse, da der måles i det frontale plan. Accelerometeret skal kunne måle en statisk acceleration i mindst en retning. Herved kan det bestemmes, hvilken retning patienterne hælder mod i stående position. Det skal kunne detektere en hældningsgrad op til $\pm90^{\circ}$, da det forventes, at forsøgspersoner kan holde sig indenfor denne grænse under udførelse af øvelserne uden fald. \\
Offsetjusteringen skal centrere det målte signal omkring $0V$, da accelerometeret ifølge pilotforsøget typisk måler $1.65V$ ved en inputspænding på $3.3V$ ved steady state. Justeringen af offset skal forekomme inden forstærkning, således at der ikke sker en forskydelse af offsettet, når accelerometret måler i positiv og negativ retning. Ved justering af offsettet må der ikke ske en ændring i signalets frekvens og amplitude. \\
Forstærkningen skal gøre det muligt at adskille det ønskede signal fra støj i den efterfølgende filtreringsblok. Signalet skal efter forstærkningen ligge indenfor arbejdsområdet $\pm5V$ og der ønskes derfor størst mulige forstærkning. Den højeste måling ved $\pm90^{\circ}$ var ifølge pilotforsøget $0.2712V.$ Derfor kan forstærkningen udregnes således:
\begin{equation}
\dfrac{5\text{V}}{0.2712\text{V}} = 18.4366 \approx 18
\end{equation}
\noindent Der ønskes en forstærkning på faktor $18$, da der skal tages forbehold for et toleranceområde. Forstærkningens gain i dB udregnes ud fra følgende formel: 
\begin{equation}
20 \cdot log_{10} (18) = 25.1055\text{dB}
\end{equation} 

\noindent\textbf{Krav:}
\begin{itemize}
	\item Accelerometeret skal minimum have en output akse.%, da der udelukkende måles i det frontale plan.
	\item Accelerometeret skal være under $5x5$ cm i dimensionerne.%, da dette gør implementeringen på patienten nemmere.
	\item Accelerometeret skal kunne måle statisk acceleration i mindst en retning.
	\item Accelerometeret skal kunne detektere en hældning fra $0^{\circ}$ til $\pm90^{\circ}$.
	\item Accelerometeret skal give et output signal i volt.
	\item Offsetjusteringen skal centrere det målte signal omkring $0V$.
	\item Forstærkeren skal have en indgangsimpedans på $3.68M\Omega$\fxnote{Da man ikke vil dræne blokken før for strøm. Udregnet ved 32Kohm, da indputimpedans skal være mindst 100 gange større end den forrige bloks outputimpedans. Accelerometrets indgangsimpedans har en afvigelse på +15\%}.% på over $1M\Omega$. \fxnote{Dette skal udregnes og forklares i teksten ovenfor}
	\item Forstærkningen skal være på 18, som svarer til $25.1055dB$.
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
	\item Der accepteres en afvigelse i detektionen af hældningsgrad på $5\%$.
	\item Der accepteres en afvigelse i forstærkningen på $2\%$.
	\item Der accepteres en afvigelse af offsetjusteringen på $10\%$.
	%\item Hældningen skal have en lille tolerance for ikke at risikere at patienten ikke vil falde og sikre at man ikke bevæger sig ud i den næste risikozone uden at der 
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\subsubsection{Forstærker} \fxnote{Forsyningsspænding? - input/output range?}
%\textbf{Krav:}
%\begin{itemize}
%\item Skal forstærke signalet med et gain på 1.
%\item Skal have en indgangsimpedans på over 1m$\Omega$.
%\end{itemize}
%\textbf{Tolerance:}
%\begin{itemize}
%\item Tolerance krav vil blive beskrevet på baggrund af pilotforsøg.
%\item Der må være en afvigelse i indgangsimpedans på 5\%.
%\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Filter}\label{FilterAfs}
Blokken indeholdende et filter anvendes til at frasortere uønskede signaler, der kan forekomme under målinger med accelerometret. Hvis disse signaler ikke frafiltreres vil det forvrænge det ønskede biologiske signal og opleves som støj. Frekvensområdet for kropshældning er ikke defineret, men studier anvender et frekvensområde liggende mellem $0.02-10Hz$ \cite{Martinez-Mendez2011}. Alle signaler, der ligger udenfor dette spektrum, ønskes derfor fjernet. I pilotforsøget blev der påvist, at signalet i dette tilfælde ligger mellem $0-25Hz$. Alt signal uden for dette spektrum ønskes derfor frafiltreret. Dette gøres ved at benytte et lavpasfilter, der har en knækfrekvens ved $25$Hz. \\
Som beskrevet i afsnit \ref{StoejAfsnit} på side \pageref{StoejAfsnit} findes der forskellige støjkilder, som kan påvirke biologiske signaler. \\
Den maksimale variation i pasbåndstransmissionen ($A_{max}$) sættes til 3dB. For at bestemme dæmpningsfaktoren og dermed fjerne $50Hz$ støj, udregnes en faktor ud fra LSB \ref{ADCafsnit} og den maksimale amlitude på signalet. Den maksimale amlitude beregnes ved en Root Mean Square (RMS) analyse ud fra rotationerne foretaget i \ref{Sec:Pilotforsoeg} for hhv. højre og venstre side. Dette gøres for at opnå den mindst mulige støj. Dæmpningsfaktoren kan udregnes således:
\begin{equation}
\dfrac{0.00244\text{V}}{0.0141\text{V}} = 0.173 \approx 0.2 
\end{equation}
\begin{equation}
\dfrac{0.00244\text{V}}{0.0118\text{V}} = 0.207  \approx 0.2
\end{equation}
Der ønskes en dæmpning på faktor $\dfrac{1}{5}$, da der tages forbehold for et tolerance område. Dæmpningens gain i dB udregnes ud fra følgende formel:   
\begin{equation}
A_{min}=20 \cdot log_{10} \cdot (\frac{1}{5}) = -13,98 \approx -14\text{dB}
\end{equation}
\textbf{Krav:}
\begin{itemize}
	\item Skal have en knækfrekvens på 25Hz.
	\item Skal have en stopbåndsfrekvens på 45Hz.
	\item Der ønskes maksimal fladhed på pasbåndet og stopbåndet.
	\item Der ønskes en minimum dæmpning af stopbåndet på 14dB.
	\item Der ønskes en maksimal variation i pasbåndet på 3dB.
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
	\item Der accepteres en afvigelse fra knækfrekvensen på $\pm10\%$.
	\item Der accepteres en afvigelse fra stopbåndsfrekvensen på $\pm5\%$.
	\item Der accepteres en afvigelse på $5\%$ ift. dæmpningen af signalet.
	\item Der accepteres en afvigelse fra pasbåndet på $\pm10\%$.
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Tilpasning}\label{Tilpasningsblok}
Blokken tilpasning har til formål at tilpasse det filtrerede signal til komparatoren. Dette gøres med en forstærker, således at spektret, der skal reguleres indenfor, øges. Derudover afgrænses måleintervallet til $\pm25^{\circ}$, da et range på $\pm90^{\circ}$ er unødvendigt ift. at vurdere hvorvidt patienten er faldet. Dermed vurderes det, at en hældning på over $25^{\circ}$ medfører fald. Der ønskes størst mulig forstærkning indenfor det afgrænsede område, som er $\pm5V$. I \eqref{Udreg1} og \eqref{Udreg2} udregnes den størst mulige spænding efter justering af offsettet. 
\begin{align}
\label{Udreg1} 1.8627V - 1.5915 = 0.2712 \\
\label{Udreg2} 1.3254 - 1.5915 = -0.2660 \\
\label{Udreg3} \dfrac{0.2712}{90} \cdot 25 = 0.0753V
\end{align}
Der ses, at \eqref{Udreg1} giver den højeste spænding. I \eqref{Udreg3} bestemmes den maksimale spænding ved $\pm25^{\circ}$ hældning. \\
I \eqref{TilpasEq1} udregnet inputspændingen efter den første forstærkning. Denne forstærkers faktor samt gain i dB udregnes i \eqref{TilpasEq2} og \eqref{TilpasEq3}.
\begin{align}
\label{TilpasEq1} 0.0753V \cdot 18 = 1.3554V \\
\label{TilpasEq2} \dfrac{5V}{1.3554V} = 3.6889 \approx 3 \\
\label{TilpasEq3} 20 \cdot log_{10} (3) = 9.5424\text{dB}
\end{align} 
I \eqref{TilpasEq1}, \eqref{TilpasEq2} og \eqref{TilpasEq3} er de $5V$ grænsen for arbejdsområdet. Der forstærkes med en faktor 3. Resultatet afrundes nedad til nærmeste hele tal. \\

\noindent\textbf{Krav:}
\begin{itemize}
	\item Forstærkningen skal være på 3, som svarer til $9.5424dB$.
	\item Indgangsimpedansen skal være over $3.2M\Omega$.
	\item Output impedansen skal være under $32K\Omega$.
	\item Output spændingen skal ligge i intervallet $\pm5V$.
\end{itemize}
\noindent\textbf{Tolerance:}
\begin{itemize}
	\item Der accepteres en afvigelse i indgangsimpedansen på ??
	\item Der accepteres en afvigelse på ??\fxnote{Skriv dette udfra pilotforsøg}.
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Komparator}\label{KomparatorAfs} 
Blokken indeholdende en komparator skal kunne sammenligne inputsignalet med en referencespænding og kunne modtage et signal mellem $\pm5V$. Komparatoren skal vha. definerede tærskelværdier bestemme hvilken hældningsgrad patienten har og i hvilken retning vedkommende hælder mod. Der skal være flere tærskelværdier, så feedbacken kan gives i flere niveauer og forskellige sværhedsgrader. Dette gør systemet fleksibelt, så det kan benyttes af patienter på forskellige balanceniveauer. Tærskelværdierne er bestemt på baggrund af pilotforsøg, hvor værdierne er beregnet ved først at finde spændingen for $90^{\circ}$, som jævnført \ref{Sec:Pilotforsoeg} på side \pageref{Sec:Pilotforsoeg} er $0.2712$V for positiv retning og -$0.2660$V i negativ retning efter forstærkning på hhv. en faktor $18$ og derefter en faktor $3$. Denne værdi divideres med $90$ for at bestemme spændingen ved $\pm1^{\circ}$ og ganges herefter med hhv. $2^{\circ}$,  $8^{\circ}$, $13^{\circ}$ og $25^{\circ}$ for at bestemme spændingen ved de enkelte hældninger.\\
\textbf{Krav:} 
\begin{itemize}
	\item Skal kunne skifte mellem sværhedsgrad ved at ændre tærskelværdierne.
	\item Skal have en forsyningsspænding på  $9V$.\fxnote{evt. rette dette til}
	\item Skal kunne modtage et inputsignal på $\pm5V$. 
	\item Skal ved et bestemt spændingsinterval aktivere en diode og vibrator:
	\begin{itemize}
		\item Grøn diode og ingen vibration: I intervallet indenfor $0,324V$ til $-0,324V$.
		\item Gul diode og let vibration: I intervallet fra $1.314V$ til $2.1168V$ og intervallet fra $-1.2744V$ til $-2.0736V$.
		\item Rød diode og moderat vibration: I intervallet fra $2.1168V$ til $4.0662V$ og intervallet fra $-2.0736V$ til $-3.9906V$.
		\item Ingen feedback: Over $4.0662V$ og under $-3.9906V$. 
	\end{itemize}
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
	\item Der accepteres en afvigelse i tærskelværdien på $\pm1\%$.
	\item Der accepteres en afvigelse i forsyningsspændingen ned til $7$V.
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Visuel feedback}
Blokken med visuel feedback omfatter den del af systemet, der giver feedback til patienten vha. LED-dioder. Der skal i alt være fem LED-dioder: En grøn, der placeres i midten, en gul på hver side af den grønne diode og en rød diode på hver side af de gule dioder. Den grønne LED-diode skal lyse, når accelerometret er placeret præcist på patienten, hvorved der er sikret den rette udgangsposition for hældningen. Dette gør, at den grønne LED-diode er aktiveret fra $0^{\circ}$-$2^{\circ}$. I intervallet $0^{\circ}$-$8^{\circ}$ lyser ingen LED-dioder. Den gule LED-diode aktiveres, når patienten skal være opmærksom på sin kropshældning, da vedkommende har bevæget sig ud i intervallet $8^{\circ}$-$13^{\circ}$. Den røde LED-diode aktiveres, når patienten er over $13^{\circ}$ og derfor er i fare for at falde. Retningen af patientens kropshældning bestemmes vha. placeringen af LED-dioderne. LED-dioderne til højre for den grønne LED-diode indikerer at patienten er ved at falde til højre. Det samme gør sig gældende for fald til venstre. Forsyningsspændingen til LED-dioderne skal udgøres af $9V$ batterier.   
\\
\textbf{Krav:}
\begin{itemize}
	\item Skal have en forsyningsspænding på  $9V$.
	\item LED-dioderne skal informere patienten om hvilken retning kropshældningen sker i.
	\item LED-dioderne skal kunne informere patienten omkring accelerometerets placering.
	\item LED-dioderne skal informere patienten om risikoen for fald.
	\item LED-dioderne skal kunne give et tydeligt lys.
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
	\item Der accepteres en afvigelse i tærskelværdien på $\pm1\%$ af LED-dioderne.
	\item Der accepteres en afvigelse i forsyningsspændingen ned til $7$V.
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Somatosensorisk feedback} 
Blokken med somatosensorisk feedback omfatter også den del af systemet, der giver feedback til patienten. Her vha. vibratorer. Der skal i alt være to vibratorer, som placeres i medialt på hver underarm. Vibrationen skal ske i modsatte side af hældning, så patienterne kan rette sig mod siden, hvor vibrationen gives. Vibratorerne skal give en bestemt vibrationshastighed ved bestemte hældningsgrader hhv. den gule og røde LED-diode. Hvis den gule LED-diode lyser, skal vibrationen være let og hvis den røde LED-diode lyser skal vibrationen være moderat. Forsyningsspændingen til vibratorerne skal udgøres af 9 V batterier.
\\
\textbf{Krav:}
\begin{itemize}
	\item Skal have en forsyningsspænding på $9$V.
	\item Vibratorerne skal informere patienten om hvilken retning kropshældningen sker i.
	\item Vibratorerne skal informere patienten om risikoen for fald.
	\item Vibratorerne skal have to vibrationshastigheder.
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
	\item Der accepteres en afvigelse i tærskelværdien på $\pm1\%$ af vibratorerne.
	\item Der accepteres en afvigelse i forsyningsspændingen ned til $7$V.
\end{itemize}

%\subsection{feedback}
%Der skal være både visuel og sensorisk feedback i form af LED-dioder og vibratorer. Der skal være fem LED-dioder, en grøn, der indikerer midtpunkt, en gul diode på hver side af den grønne diode, en rød diode på hver side af den gule diode. Den gule diode skal begynde at lyse ved en bestemt hældningsgrad, der indikerer at patienten skal være opmærksom på sin balance. Den røde diode skal begynde at lyse ved en bestemt hældningsgrad, der indikerer at patienten er i fare for at falde. Dioderne til højre for den grønne diode, skal indikere at patienten falder til højre. Det samme gør sig gældende for fald til venstre. Den sensoriske feedback skal vibrere ved en bestemt hældningsgrad, samtidig med de enkelte dioder lyser. Hvis den gule diode lyser, skal vibrationen være let og hvis den røde diode lyser skal vibrationen være moderat. Der skal placeres en vibrator på højre side og venstre side af patienten, der skal indikere i hvilken retning patienten falder. Spændingsforsyningen til feedbacksystem skal udgøres af 9 V batterier. \\
%\textbf{Krav:}
%\begin{itemize}
%\item Skal have en spændingsforsyning på 9 V.
%\item Vibratorerne skal have mindst to vibrationshastigheder.
%\item LED-dioderne og vibratorerne skal informere patienten om hvilken retning hældningen sker.
%\item LED-dioderne og vibratorerne skal informere patienten om risikoen for fald.
%\item LED-dioderne skal kunne lyse kraftigt nok til at kunne ses på fem meters afstand.
%\end{itemize}
%\textbf{Tolerance:}
%\begin{itemize}
%\item Der accepteres en afvigelse i tærskelværdien på $\pm$ 2 \% af feedbacken.
%\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Spændingsforsyning}
I systemet anvendes der en spændingsforsyning af batterier. Dette gøres for at undgå tilslutning til elnettet og gøre selve systemet trådløst, hvilket gør det mere anvendeligt for patienten. Spændingsforsyningen kan havde inflydelse på hvilket outputsignal der opnås og det er derfor vigtigt at spændingen indstilles således at signalet ikke bliver klippet. \\
\noindent\textbf{Krav:}
\begin{itemize}
\item Skal være forsyning for samtlige blokke i systemet
\item Spændingsforsyningen må ikke få signalet klippet
\item Spændingen skal være minimalt $\pm$ XXV \fxnote{dette finder vi ud af efter vejledermødet} og maksimalt $\pm9V$.
\end{itemize}
\noindent\textbf{Tolerance:}
\begin{itemize}
\item Der accepteres ingen afvigelse for minimum og maksimum for spændingsforsyningen
\item Der accepteres ingen klipning af signalet
%\item Der accepteres ingen spænding højere end dioderne kan tåle \fxnote{måske en anden måde det kan skrives på}
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{ADC}
Blokken med en ADC anvendes i systemet, for at konvertere det analoge signal til digitalt. %Den skal kunne sample det forstærkede signal. 
ADC'ens inputsignal skal ligge i området $\pm5V$. Båndbredden på accelerometeret bestemmer hvilken samplingsfrekvens, der skal benyttes. I følge Nyquists sætning skal der samples med minimun det dobbelte af det biologiske signal. I praksis samples der med minimum det tidobbelte. I dette tilfælde er båndbredden $50Hz$, dvs. at der som minimum skal samples med $100Hz$, og i praksis vil det være hensigtsmæssigt at sample med minimum $500Hz$. \\
\textbf{Krav:}
\begin{itemize}
	\item Skal kunne modtage et inputsignal i intervallet $\pm 5 V$.
	\item Skal have en samplingsfrekvens på minimum $500Hz$.
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
	\item Der accepteres ingen afvigelse ift. ADCen.
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{USB-isolator}\label{kravspecifikationer_USB}
Blokken med USB-isolatoren anvendes i systemet for at øge patientens sikkerhed. USB-isolatoren isolerer patienten fra kredsløbet og sørger, at der ikke løber lækstrømme fra computeren ind i systemet.\\
\textbf{Krav:}
\begin{itemize}
	\item Skal have den samme outputspænding som inputspænding. 
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
	\item Der accepteres en afvigelse på $\pm2\%$ for USB-isolatoren. 
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%55
\subsection{Software}\label{subsec:software}
Blokken indeholdende softwaren implementeres i systemet for at kunne beahndle og gemme patienternes øvelsesresultater. Denne del af systemet er brugerfladen for det fagkyndige personale og skal derfor kunne fremvise information omkring patienternes balance i form af grafer eller lignende. Det fagkyndige personale skal vha. af softwaren kunne følge med i patienternes udvikling ift. balancen. \\
\textbf{Krav:}
\begin{itemize}
	\item Skal kunne fremvise information om patientens hældning i de enkelte øvelser, herunder hvor ofte patienten har bevæget sig ud i risikozonerne. 
	\item Skal kunne gemme data.
	%\item Skal være brugervenligt for det fagkyndige personale, dvs. designet af programmet skal være enkelt. 
\end{itemize}
\textbf{Tolerance:}
\begin{itemize}
	\item Der accepteres ingen afvigelse ift. software. 
\end{itemize}