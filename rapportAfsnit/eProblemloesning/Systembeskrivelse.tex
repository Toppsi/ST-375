% !TeX spellcheck = da_DK
\section{Systembeskrivelse}  
Dette afsnit indeholder en beskrivelse af det system, der skal kunne anvendes af apopleksipatienter som et selvstændigt træningsapparat i rehabiliteringen af balanceproblemer. Systembeskrivelsen indeholder målgruppen for designet, samt hvilket formål og anvendelse det har. Ud fra disse faktorer er systemet blevet designet og illustreret i et blokdiagram. 

\subsection{Systemets bruger}
Systemet udvikles til apopleksipatienter med balanceproblemer mhp. selvtræning af balance i rehabiliteringsfasen, der bliver omtalt som fase 3 og 4 i afsnit \ref{Faser} på side \pageref{Faser}. Jævnfør afsnit \ref{Indledning} på side \pageref{Indledning} ses det, at majoriteten af apopleksipatienter er over 65 år, og systemet skal derfor være let anvendeligt. Fagkyndigt personale, såsom fysioterapeuter og læger, skal kunne instruere patienten i brugen af systemet samt følge med i udviklingen, som patienten gennemgår. Det skal derfor være muligt for det fagkyndige personale at anvende systemet og aflæse data herfra. Dette gøres ved, at systemet både har et analogt og digitalt output, hvor det digitale henvender sig mere til det fagkyndige personale, mens det analoge henvender sig til apopleksipatienterne. 

\subsection{Systemets formål og anvendelse}
Systemet har til formål at gøre apopleksipatienter opmærksomme på, hvornår de mister balancen. Systemet skal derfor kunne registrere, hvis patienten er i risiko for at falde. Inden et fald sker udsendes et feedback signal, så patienterne har mulighed for at rette sig op. Selve systemet skal anvendes til selvtræning i hjemmet. Systemet skal fungere som en hjælp for patienten, da vedkommende bliver bevidst omkring sin balance. Herved kan patienten være mere selvstændig i rehabiliteringsprocessen.

Systemet er designet til, at patienten under anvendelsen skal udføre en bestemt øvelse. Denne øvelse foretages i stående udgangsposition med fødderne på en tegnet linje, så den ene fods tæer er mod den anden fods hæl. Denne position er valgt for at udfordre patientens balance ved at fordele kropsvægten anderledes ift. den normale kropsstilling omtalt i afsnit \ref{BalanceAfsnit} på side \pageref{BalanceAfsnit}. 
% Patienten påsætter selv systemet øverst på sternum og udfører herefter en kort prøvetest for at kende til de givne feedback parametre.Under prøvetesten svajer patienten langsomt fra side til side. 
Det er på baggrund af afsnit \ref{MekBioFeed} på side \pageref{MekBioFeed} valgt at hældningen på patienten skal opfanges via et accelerometer, som er placeret øverst på sternum. Da systemet skal være selvstændigt påsætter patienten selv systemet øverst på sternum. Systemet skal give sensorisk og visuel feedback i form af en vibrator samt fem dioder bestående af en grøn, to gule og to røde. Hvis patienten hælder i intervallet $5^{\circ}$-$10^{\circ}$   til højre, indikeres dette af den gule diode på højresiden af den grønne diode. Derudover aktiveres en mild vibration, når den gule diode lyser. Hvis patienten hælder $10^{\circ}$ eller derover, lyser den røde diode til højre for den gule diode og vibrationen bliver forøget. Det samme gør sig gældende for hældning mod venstre. Med denne metode indikeres både, hvilken retning patienten svajer samt graden heraf. Ved benyttelse af to feedback former er der større mulighed for, at patienten kan opfange signalerne. Hvis patientens visuelle sans er begrænset kan systemet stadig benyttes grundet den sensoriske feedback. \\ 
Efter testøvelsen udføres selve træningsøvelsen, hvor udgangspositionen indtages på linjen. For at øge sværhedsgraden kan den visuelle sans udelukkes. Patienten skal forsøge at holde balancen så længe som muligt uden at bevæge sig ud i risikozonerne. Hvis patienten kommer ud i risikozonerne vil dette blive markeret ved lys i dioderne samt vibration. Træningsøvelsen gentages efter behov. Ved at tage flere målinger igennem rehabiliteringsforløbet vil det forventes, at der sker en fremgang ift. tiden, hvori balancen kan opretholdes uden at patienten bevæger sig ud i risikozonerne. 

%\subsection{Accelerometer}
%I forsøget anvendes ADXL327 som er et tre-akset accelerometer ift. forsøget gives det elektriske signal ud fra X og Z-aksen. Produktet måler accelerationen med minimum fuldskala på \pm 2g. Sensitiviteten afhænger af forsyningsspændingen og ved 3V er sentivitivten 420mv/g. 

%Ledningerne snoes for at kontrollere samt mindske støjen. Derudover sættes ledninger fast med tape på patienten, så vidt det er muligt. For at undgå unødvendigt støj foretages forsøget væk fra andet elektronik.  %\ref{reference til støj afsnittet}

%\subsection{Analogt output}
%Det analoge output skal kunne henvende sig til patienten, dette sker ved lysdioder og vibration. Lysdioderne skal lyse gult ved 'usikkerhed' og slukke hvis patienten enten er rettet op igen eller bevæger sig ud i riskozonen, hvorefter en ny diode skal lyse rødt. Vibrationerne igangsættes ved 'usikkerhed' og skal stoppe hvis patienten retter sig op eller stige i styrke, hvis patienten kommer ud i risikozonen. 

%\subsection{Digitalt output}
%Det digitale skal kunne anvendes af sundhedspersonale til at vurdere om patienten gør fremskridt, dette indebærer at informationerne for patienten kan gemmes og sammenlignes på en computer. 


\subsection{Systemets opbygning}
Systemets opbygning fremgår af \figref{kravblok}.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.7]{figures/cProblemloesning/Systemopbygning.PNG}
	\caption{Figuren viser de enkelte blokke, som systemet skal indeholde.}
	\label{kravblok}
\end{figure}

Det biologiske signal der opnås fra accelrometeret skal forstærkes (instrumenteringsforstærker?). Dette gøres fordi signalerne der opfanges er meget små og det vil derfor gøre filtreringen mere præcis ved at forstærke signalet.
Herefter benyttes der et højpas filter for at frasortere den støj der kommer fra tyngdekraften. \fxnote{Der skal tilføjes noget om højpas filter ligesom det der står ved lavpas filter} Dernæst benyttes et lavpas filter for at frasortere støjen fra frekvenser over 45 Hz. Grunden til disse frekvenser kan frasorteres, er at det signal som skal måles ligger under 45 Hz. Efter filtreringen af signalet benyttes en variabel forstærker, for at tilpasse signalets amplitude til ADC’en og komparatoren. Signalet ledes herefter videre i et analogt og digitalt kredsløb. I det analoge kredsløb kommer signalet først gennem en komparator. Denne skal sammenligne signalet der optages, så den rigtige feedback kan gives til patienten. Feedbacken bliver givet til patienten, således det bliver muligt at holde balancen, dette gøres i form at dioder og vibratorer. I det digitale kredsløb, bliver signalet ledt ind i en ADC. Denne vil omdanne det analoge biologiske signal til et digitalt signal. Det digitale signal bliver herefter ledt ind i en USB-isolator, så der ikke opstår lækstrømme og for at sikre patientens sikkerhed. Til sidst vil det digitale signal overført til en computer, hvor signalet herefter vil kunne gemmes. Det bliver herved muligt at databehandle signalet og opstille det som en graf eller lignende.

\subsection{Kravspecifikationer}
For at gøre anvendelse af samme system muligt til 4. Semester skal arbejdsområdet kunne benyttes sammen med et USB-baseret trådløst udviklingsværktøj eZ430-RF2500 fra Texas Instruments. Det er derfor nødvendigt, at designet stemmer overens med udviklingsværktøjet for at kunne sende og modtage data til og fra computeren. Udviklingsværktøjet indeholder hardware og software som evaluerer mikrokontrolleren MSP430F2274. For at hele vores system kan anvendes med udviklingsværktøjet, skal outputsignalet være 0-3V, eftersom mikrokontrolleren opererer med spændingsforsyning mellem 1,8V og 3,6V. \\
I praksis er det ikke muligt at have ideelle komponenter. Der vurderes derfor ud fra et pilotforsøg den tolerance, der accepteres ift. de enkelte blokke i systemet. Dette er udført mhp. at kunne beregne forstærkning, filtrering og integrering af signalet.\fxnote{Husk at opdatere her, når der kommer flere blokke}

\subsubsection{Det samlede system}
Systemet skal ved sammenligning af inputtet fra accelerometeret og output fra dioder samt vibration give et analogt output. På denne måde vil aktivering af bestemte dioder afspejle inputsignalet, således at et input svarede til 5$^{\circ}$ aktiverer en gul diode og vibration, mens et input svarende til 10$^{\circ}$ vil aktivere af en rød diode og stigningen i vibration. Derimod vil et input hvor opretholdelsen af balancen er korrekt svare til < 5$^{\circ}$, hvilket gør at den grønne diode vil lyse. 

\textbf{Overordnede krav til systemet:}
\begin{itemize}
\item Grøn diode: Skal lyse, når patienten ikke er ude i risikozonerne.  
\item Gul diode: Skal lyse, når patienten hælder 5$^{\circ}$ og slukke, hvis patienten retter sig op eller hælder yderligere.
\item Rød diode: Skal lyse, når patienten hælder 10$^{\circ}$ eller mere og slukke, hvis patienten retter sig op.
\item Vibration: Skal aktiveres, hvis patienten hælder 5$^{\circ}$ og skal slukke, hvis patienten retter sig op. Hvis patienten hælder yderligere, skal vibrationen stige.
\item Der skal være en sammenhæng mellem inputsignalets størrelse og antallet af dioder der lyser.
\item Signalet i systemet må ikke forstærkes til en værdi over 3V.
\end{itemize}



%\textbf{Tolerance:}
%\begin{itemize}
%\end{itemize}
%
%\subsubsection{Accelerometer}
%\textbf{Krav:}
%\begin{itemize}
%\end{itemize}
%
%\textbf{Tolerance:}
%\begin{itemize}
%end{itemize}
%
%\subsubsection{Instrumentering forstærker}
%\textbf{Krav:}
%\begin{itemize}
%\end{itemize}
%
%\textbf{Tolerance:}
%\begin{itemize}
%\end{itemize}
%
%\subsubsection{Filtre - opdeling i høj og lavpass?}
%\textbf{Krav:}
%\begin{itemize}
%\end{itemize}
%
%\textbf{Tolerance:}
%\begin{itemize}
%\end{itemize}

%\subsubsection{Forstærker med variabel forstærkning}

%\textbf{Krav:}
%\begin{itemize}
%\end{itemize}
%
%\textbf{Tolerance:}
%\begin{itemize}
%\end{itemize}
%
%\subsubsection{Ensretter}

%\textbf{Krav:}
%\begin{itemize}
%\end{itemize}
%
%\textbf{Tolerance:}
%begin{itemize}
%end{itemize}
%
%\subsubsection{Integrator}
%\textbf{Krav:}
%\begin{itemize}
%\end{itemize}
%
%\textbf{Tolerance:}
%\begin{itemize}
%\end{itemize}
%
%\subsubsection{Advarsel}
%\textbf{Krav:}
%\begin{itemize}
%\end{itemize}
%
%\textbf{Tolerance:}
%\begin{itemize}
%\end{itemize}
%
%\subsubsection{ADC}
%\textbf{Krav:}
%\begin{itemize}
%\end{itemize}
%
%\textbf{Tolerance:}
%\begin{itemize}
%\end{itemize}
%
%\subsubsection{USB-isolator}
%\textbf{Krav:}
%\begin{itemize}
%\end{itemize}
%
%\textbf{Tolerance:}
%\begin{itemize}
%\end{itemize}
%
%\subsubsection{Computer}
%\textbf{Krav:}
%\begin{itemize}
%\end{itemize}
%
%\textbf{Tolerance:}
%\begin{itemize}
%\end{itemize}
%\begin{itemize}
%\item Systemet skal ved fald få dioder til at lyse samt give feedback i form af stigende vibration. 
%\item Systemet skal være non-invasiv - dvs. systemet ikke må påføre patienten smerte eller varig skade
%\item Systemet skal være brugervenligt
%\item Systemet skal forsynes med spænding fra 9V batteri
%\end{itemize}

%\subsubsection{Accelerometer}
%Accelerometeret skal detektere patientens kropshældning.

%\subsubsection{Filter}
%Når der anvendes et filter, skal det dæmpe uønskede frekvenser. Dvs. frekvenser der lavere eller højere ift. det signal fra accelerometeret, som man vil analysere på. Der skal udføres et pilotforsøg for at finde frem til det korrekte filter og valg af knækfrekvens. 

%\subsubsection{Signalerende lys}
%Når patienten er ude af balance skal en rød diode lyse, som signalering ift. patientens hældning. Der skal vha. et pilotforsøg detekteres, hvornår dioden skal lyse. Skal der evt. være 2 dioder, hvor den ene er et "advarende" signal og nr. to er "fare". 

%\subsubsection{Alarm/vibrationen}
%Alarmen/vibrationen skal anvendes i perioden, hvor patienten er ude af balance og stoppe igen, når der igen er oprettet balance. 
%(eller fungere som en alarm til dioderne - så når en diode lyser, skal alarmen gå)

%\subsubsection{ADC}
%Der anvendes en ADC i systemet, for at konvertere det analoge signal til digitalt. Det næste skridt er konverteringen til PC og det er derfor essentielt at have en ADC, der konverterer analogt signal til binære tal, som digitale systemet anvender. 
%{Her skal vi have valgt en samplingsfrekvens)

%\subsubsection{USB-isolater}
%USB-isolatoren sikre patientens sikkerhed. Her skal input- og outputspænding være ens.  

%\subsubsection{Til PC}
%Fremvisning af graf, så patienten og plejepersonale kan følge %rehabiliteringens udvikling. 
